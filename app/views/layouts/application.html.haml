!!! 5
%html{lang: "en"}
  %head
    %title Providechat App

    %meta{charset: "utf-8"}
    %meta{content: "IE=edge", "http-equiv" => "X-UA-Compatible"}
    %meta{name: 'viewport', content: 'width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0'}
    %meta{name: "description", content: "Provide Chat Application"}
    %meta{name: "author", content: "Provide Chat software"}

    %link{href: "/favicon.ico", rel: "shortcut icon"}

    = stylesheet_link_tag    "application", media: "all"
    = javascript_include_tag 'application'
    = javascript_include_tag 'modernizr'
    = csrf_meta_tags

    / HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries
    /[if lt IE 9]
      %script{:type => "text/javascript", :src => "https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"}
      %script{:type => "text/javascript", :src => "https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"}

      <!-- GOOGLE FONT -->
      %link{href: "http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,300,400,700", rel: "stylesheet"}
  %body

    = render 'layouts/header'

    %aside#left-panel
      .login-info
        %span
          %a{:href => "#"}
            = current_agent.avatar.nil? ? image_tag('images/avatars/silouette.gif'): image_tag(current_agent.avatar.url)
            %span
              = current_agent.name
          .btn-group.pull-right
            - if current_agent.availability == 'online'
              %button.btn.dropdown-toggle.btn-xs.btn-success{:id => "agent-status", "data-toggle" => "dropdown"}
                Online
                %i.fa.fa-caret-down
            - else
              %button.btn.dropdown-toggle.btn-xs.btn-danger{:id => "agent-status", "data-toggle" => "dropdown"}
                Offline
                %i.fa.fa-caret-down
            %ul.dropdown-menu.js-status-update{:role => "menu"}
              %li
                %a{:href => "javascript:void(0);", :data => {:status => 'online'}}
                  %i.fa.fa-circle.txt-color-green
                  Online
              %li
                %a{:href => "javascript:void(0);", :data => {:status => 'offline'}}
                  %i.fa.fa-circle.txt-color-red
                  Offline
              %li.divider
              %li
                %a{:href => "javascript:void(0);", :data => {:status => 'signoff'}}
                  %i.fa.fa-power-off
                  Sign Off
      / end user info
      = render "layouts/left_nav"
    / END NAVIGATION
    / MAIN PANEL
    #main{:role => "main"}
      #content
        = yield

    = javascript_include_tag 'smartadmin.config'
    = javascript_include_tag 'jarvis.widget'
    = javascript_include_tag 'smart-notification'
    = javascript_include_tag 'smartadmin'

    :javascript
      $(document).ready(function() {

        pageSetUp();

        function update_agent_availability(status) {
          $.ajax({
            type: "PUT",
            contentType: "application/json; charset=utf-8",
            url: "/api/agents/#{current_agent.id}",
            dataType: "json",
            data: JSON.stringify({agent: {availability: status}, id: #{current_agent.id}}),
          });
        }

        $(".js-status-update a").click(function() {
          var selText = $(this).text();
          var status = $(this).data('status');
          var $this = $(this);
          $this.parents('.btn-group').find('.dropdown-toggle').html(selText + ' <span class="caret"></span>');
          $this.parents('.dropdown-menu').find('li').removeClass('active');
          if (status === 'online') {
            $('#agent-status').removeClass('btn-danger');
            $('#agent-status').addClass('btn-success');
            update_agent_availability('online');
          } else if (status === 'offline') {
            $('#agent-status').removeClass('btn-success');
            $('#agent-status').addClass('btn-danger');
            update_agent_availability('offline');
          } else if (status === 'signoff') {
            alert("Are you sure?");
          }
          $this.parent().addClass('active');
        });
      });
